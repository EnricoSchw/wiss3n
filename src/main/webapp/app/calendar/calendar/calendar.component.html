<div class="row text-center calendar-head">
    <div class="col-md-4">
        <div class="btn-group">
            <div
                class="btn btn-primary"
                mwlCalendarPreviousView
                [view]="view"
                [(viewDate)]="viewDate"
                (viewDateChange)="navigateCalendar('back')">
                Previous
            </div>
            <div
                class="btn btn-outline-secondary"
                mwlCalendarToday
                [(viewDate)]="viewDate">
                Today
            </div>
            <div
                class="btn btn-primary"
                mwlCalendarNextView
                [view]="view"
                [(viewDate)]="viewDate"
                (viewDateChange)="navigateCalendar('forward')">
                Next
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <h3>{{ viewDate | calendarDate:(view + 'ViewTitle'):'de' }}</h3>
    </div>
    <div class="col-md-4">
        <div class="btn-group">
            <div
                class="btn btn-primary"
                (click)="view = 'month'"
                [class.active]="view === 'month'">
                Month
            </div>
            <div
                class="btn btn-primary"
                (click)="view = 'week'"
                [class.active]="view === 'week'">
                Week
            </div>
            <div
                class="btn btn-primary"
                (click)="view = 'day'"
                [class.active]="view === 'day'">
                Day
            </div>
        </div>
    </div>
</div>


<ng-template #customMonthCellTemplate let-day="day" let-locale="locale">
    <div class="cal-cell-top" *ngIf="day.date.getDay() > 0">
        <!--<span class="cal-day-badge" *ngIf="day.badgeTotal > 0">{{ day.badgeTotal }}</span>-->
        <span class="cal-day-number">{{ day.date | calendarDate:'monthViewDayNumber':locale }}</span>
    </div>
    <small class="custom-event-month" *ngFor="let event of day.events; index as i; first as isFirst">
        <span>
            <span class="custom-event-month-subject" [ngStyle]="{'color': event.color.primary}">{{event.meta.subjectHour.prefix}}</span>
            {{event.title}}
        </span>
    </small>

</ng-template>


<ng-template
    #customWeekEventTemplate
    let-weekEvent="weekEvent"
    let-tooltipPlacement="tooltipPlacement"
    let-eventClicked="eventClicked"
    let-tooltipTemplate="tooltipTemplate"
    let-tooltipAppendToBody="tooltipAppendToBody">
    <div
        class="cal-event"
        [style.backgroundColor]="weekEvent.event.color?.secondary"
        [style.borderColor]="weekEvent.event.color?.primary"
        [mwlCalendarTooltip]="weekEvent.event.title | calendarEventTitle:'weekTooltip':weekEvent.event"
        [tooltipPlacement]="tooltipPlacement"
        [tooltipEvent]="weekEvent.event"
        [tooltipTemplate]="tooltipTemplate"
        [tooltipAppendToBody]="tooltipAppendToBody"
        (mwlClick)="eventClicked.emit()">
        <mwl-calendar-event-actions [event]="weekEvent.event"></mwl-calendar-event-actions>
        <mwl-calendar-event-title
            [event]="weekEvent.event"
            [customTemplate]="eventTitleTemplate"
            view="week">
        </mwl-calendar-event-title>
        <div *ngFor="let taskEvent of weekEvent.event.meta.events; trackBy:trackByIndex" class="xx">
            <span class="custom-event-month-subject" [ngStyle]="{'color': taskEvent.color.primary}">{{convertTypeToString(taskEvent.meta.task.type)}}</span>
            {{taskEvent.title}}
        </div>
    </div>
</ng-template>

<ng-template
    #customEventTitleTemplate
    let-event="event"
    let-view="view">
    <span class="cal-event-title-number">{{event.meta.subjectHour.hour.index}}</span>
    <span class="cal-event-title">{{ event.title }}</span>
</ng-template>

<ng-template
    #customDayEventTemplate
    let-dayEvent="dayEvent"
    let-tooltipPlacement="tooltipPlacement"
    let-eventClicked="eventClicked"
    let-tooltipTemplate="tooltipTemplate"
    let-tooltipAppendToBody="tooltipAppendToBody">
    <jhi-subject-hour-view
        [dayEvent]="dayEvent">
    </jhi-subject-hour-view>
    <div class="line top"></div>
    <div class="line bottom"></div>
    <div class="line right" [hidden]="!dayEvent.event.meta.isActive"></div>
    <div
        class="cal-event"
        [ngClass]="{ 'active': dayEvent.event.meta.isActive }"
        [style.backgroundColor]="dayEvent.event.color?.secondary"
        [style.borderColor]="dayEvent.event.color?.primary"
        [mwlCalendarTooltip]="dayEvent.event.title | calendarEventTitle:'dayTooltip':dayEvent.event"
        [tooltipPlacement]="tooltipPlacement"
        [tooltipEvent]="dayEvent.event"
        [tooltipTemplate]="tooltipTemplate"
        [tooltipAppendToBody]="tooltipAppendToBody"
        (mwlClick)="eventClicked.emit()">
        <mwl-calendar-event-actions [event]="dayEvent.event"></mwl-calendar-event-actions>
        &ngsp;
        <mwl-calendar-event-title
            [event]="dayEvent.event"
            [customTemplate]="customEventTitleTemplate"
            view="day"
            (mwlClick)="eventClicked.emit()">
        </mwl-calendar-event-title>
    </div>
</ng-template>


<ng-template #loading>
    <div class="text-center">
        <i class="fa fa-spin fa-spinner fa-5x"></i>
        <br>
        Events...
    </div>
</ng-template>



    <div [ngSwitch]="view" style="overflow:hidden;" *ngIf="weekEvents$ | async; else loading; let weekEvents">
        <mwl-calendar-month-view
            *ngSwitchCase="'month'"
            [viewDate]="viewDate"
            [events]="monthEvents"
            [excludeDays]="excludeDays"
            [locale]="de"
            [cellTemplate]="customMonthCellTemplate"
            (dayClicked)="viewDate = $event.day.date; view = 'week'">
        </mwl-calendar-month-view>
        <mwl-calendar-week-view
            *ngSwitchCase="'week'"
            [excludeDays]="excludeDays"
            [viewDate]="viewDate"
            [locale]="de"
            [eventTemplate]="customWeekEventTemplate"
            [events]="weekEvents"
            (dayHeaderClicked)="viewDate = $event.day.date; view = 'day'"
            (eventClicked)="clickSubjectEventInWeek($event)">
        </mwl-calendar-week-view>
        <mwl-calendar-day-view
            *ngSwitchCase="'day'"
            [viewDate]="viewDate"
            [events]="weekEvents"
            [locale]="de"
            [eventTemplate]="customDayEventTemplate"
            [dayStartHour]="0"
            [dayEndHour]="10"
            (beforeViewRender)="beforeDayViewRender($event)"
            (eventClicked)="clickSubjectEventInDay($event)">
        </mwl-calendar-day-view>
    </div>

